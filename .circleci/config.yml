version: 2

aliases:
  - &local_setup
    run:
      name: Installing the 3rd parties ...
      command: |
        nix-env -i git findutils gnugrep coreutils openssh stack
        # Circle CI needs git/ssh in /usr/bin
        ln -s $(find /nix -type f -name git | grep libexec | head -n1) /usr/bin
        ln -s $(find /nix -type f -name ssh | grep openssh | head -n1) /usr/bin
jobs:
   build:
     docker:
       - image: nixos/nix
     steps:
       - *local_setup
       - checkout
       - run: echo "A first hello"
       - run: .ci/build_withStack.sh
